<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>15パズル — 完全版</title>
<style>
  :root{--bg:#f4f7fb;--card:#fff;--primary:#3b82f6;--muted:#6b7280;--accent:#ffb020;--tile:#60a5fa;--tile-text:#fff;--disabled:#cbd5e1}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,var(--bg),#eef6ff);color:#0f172a;display:flex;align-items:flex-start;justify-content:center;min-height:100vh;padding:24px}
  .wrap{width:100%;max-width:980px;background:var(--card);border-radius:14px;box-shadow:0 8px 30px rgba(11,26,48,0.06);padding:18px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between}
  h1{font-size:18px;margin:0}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{background:var(--primary);color:white;border:none;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
  .btn.secondary{background:transparent;color:var(--primary);border:1px solid rgba(59,130,246,0.12)}
  .btn.ghost{background:transparent;color:var(--muted);border:1px solid #eef2f7}
  .btn:disabled{background:var(--disabled);color:#fff;cursor:not-allowed;opacity:0.9}
  main{display:flex;gap:20px;margin-top:16px;align-items:flex-start}
  .left{flex:0 0 52%;min-width:260px}
  .right{flex:1}
  .board-wrap{background:linear-gradient(180deg,#fff,#f7fbff);padding:16px;border-radius:12px;border:1px solid #edf2f7}
  #puzzle{position:relative;width:100%;max-width:520px;aspect-ratio:1/1;background:transparent;border-radius:10px}
  .cell{position:absolute;transition:transform .18s cubic-bezier(.2,.8,.2,1);width:calc(25% - 6px);height:calc(25% - 6px);display:flex;align-items:center;justify-content:center;border-radius:10px}
  .tile{background:var(--tile);color:var(--tile-text);font-weight:700;font-size:clamp(18px,3.6vw,28px);user-select:none;cursor:pointer;box-shadow:0 8px 18px rgba(14,82,196,0.12);display:flex;align-items:center;justify-content:center}
  .tile:hover{transform:translateY(-4px)}
  .empty{background:transparent;cursor:default;box-shadow:none}
  .meta{display:flex;gap:8px;align-items:center;margin-top:12px}
  .progress{flex:1;background:#eef2f7;border-radius:999px;height:12px;overflow:hidden}
  .progress>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--primary));width:0%;transition:width .35s ease}
  .meta .label{font-size:13px;color:var(--muted)}
  .skills{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .skill-btn{padding:8px 10px;border-radius:8px;background:#fff;border:1px solid #e6eefc;cursor:pointer;display:flex;align-items:center;gap:8px}
  .skill-btn.disabled{opacity:0.5;cursor:not-allowed}
  .guide{background:#fff;border-radius:10px;padding:12px;border:1px solid #f1f5f9}
  .msg{position:fixed;left:50%;top:14%;transform:translateX(-50%);background:rgba(15,23,42,0.95);color:white;padding:12px 18px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.3);display:none;z-index:1000}
  .msg.show{display:block;animation:pop .36s ease}
  @keyframes pop{from{transform:translate(-50%,-10px) scale(.98);opacity:0}to{transform:translate(-50%,0) scale(1);opacity:1}}
  .clear-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.8);background:var(--primary);color:white;padding:20px 28px;font-size:24px;border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,0.25);display:none;z-index:1001;text-align:center;animation:popClear .5s forwards}
  @keyframes popClear{0%{transform:translate(-50%,-50%) scale(0.8);opacity:0}50%{transform:translate(-50%,-50%) scale(1.1);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:1}}
  @media(max-width:900px){main{flex-direction:column}.left{order:2}.right{order:1}}
</style>
</head>
<body>
<div class="wrap" role="application" aria-label="15パズルゲーム">
<header>
<div>
<h1>15パズル — 完全版</h1>
<div style="font-size:13px;color:var(--muted)">矢印キー / クリックでプレイ。上2行揃いで技リチャージ。</div>
</div>
<div class="controls">
<button class="btn" id="restartBtn">⟲ Restart</button>
<button class="btn secondary" id="shuffleBtn">Shuffle</button>
<button class="btn ghost" id="soundToggle">🔊 ON</button>
<label style="display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px">
<input type="checkbox" id="timeAttackChk" /> Time Attack
</label>
<label style="display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px">
Stage
<select id="stageSelect" style="border-radius:8px;padding:6px 8px">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
</select>
</label>
<div id="timer" style="min-width:80px;text-align:right;color:var(--muted)">00:00.00</div>
</div>
</header>
<main>
<div class="left">
<div class="board-wrap">
<div id="puzzle" aria-label="パズル盤面"></div>
<div class="meta">
<div class="label" style="font-size:13px;color:var(--muted)">上2行の揃い度</div>
<div class="progress" aria-hidden="true"><i id="progressBar"></i></div>
<div style="width:64px;text-align:right;font-size:13px;color:var(--muted)" id="progressText">0/8</div>
</div>
</div>
<div class="skills" id="skills">
<button class="skill-btn" id="skill-shuffle">🌀 シャッフル</button>
<button class="skill-btn" id="skill-swap">💨 スワップ</button>
<button class="skill-btn" id="skill-line">🔥 ライン回転</button>
<button class="skill-btn" id="skill-hint">⚡ ヒント</button>
</div>
<div style="margin-top:8px;font-size:13px;color:var(--muted)">操作: 矢印キー / タップ</div>
</div>
<div class="right">
<div class="guide" role="note">
<h3 style="margin:0 0 8px 0">遊び方</h3>
<p style="margin:0;color:var(--muted)">クリック/タップまたは矢印キーでタイルを動かして、1〜15を順に並べよう。上2行が揃うと技が全回復。全て揃うとクリア表示！</p>
<ul style="margin:8px 0 0 18px;color:var(--muted);font-size:13px">
<li>🌀 シャッフル: 盤面をランダム化</li>
<li>💨 スワップ: 任意の2タイルを入れ替え</li>
<li>🔥 ライン回
